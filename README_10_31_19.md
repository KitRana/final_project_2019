# final_project_2019

About Us
This project was developed as a class project for the May 2019 Data Science program at Rutgers University. The group consisted of three members listed below.

Ankit Rana
Charlie Blasi

The Project
Our goal for this project was to look at various factors of public safety within New York City. We wanted to gather as much data as we could find from publicly available sources including Datasets, API's, and Websites.

With data sources in hand we were able to create and deploy a functioning web application. Below are the tools we used to perform both the server-side and front-end operations.

Python/Flask: The code to scrape news and social media information from various news outlets was written using Python. We then used Flask deploy the application to the web.
MongoDB: MongoDB was used as the database to run CRUD operations on the scraped data.
Leaflet: The Leaflet JavaScript library was used to display our data as overlays on an interactive map provided by Mapbox.
Plotly: The Plotly library was used to create the interactive graphs used to display EMS Response Times.

Leaflet Geo-Mapping
Leaflet is the leading open-source JavaScript library for mobile-friendly interactive maps. Weighing just about 38 KB of JS, it has all the mapping features most developers ever need. Explore Leaflet.

Using the Mapbox API, we started with light and dark base maps. Once the base maps were set, various datasets and API endpoints were used to extract data to create the layers that would be placed on top of the base maps.

Dataset Description
The data for the interactive layers of the map were sourced from NYC Open Data. Although, the all the data for layers came from Open Data, each layer uses a different API endpoint. The various layers used are below.

Boroughs: A geoJson file used to map the boundaries of each NYC borough.
Data Source
Precincts: A geoJson file used to map the jurisdiction area of each NYPD Precinct.
Data Source
Arrests: An API endpoint of every arrest in NYC going back to 2006 through the end of the previous calendar year.
Data Source
Shootings: An API endpoint of every shooting incident that occurred in NYC going back to 2006 through the end of the previous calendar year.
Data Source
Summons: An API endpoint of every criminal summons issued in NYC going back to 2006 through the end of the previous calendar year.
Data Source
Crashes: An API endpoint of motor vehicle collisions in which someone is injured or killed, or where there is at least $1000 worth of damage.
Data Source
Complaints: An API endpoint all valid felony, misdemeanor, and violation crimes reported to the New York City Police Department (NYPD) from 2006 to the end of 2017.
Data Source

Layers
Boroughs
Overlay of borough boundaries and a different color for each borough.
Precincts
Overlay of NYPD Precinct boundaries.
Arrests
Color: The blue shade is determined by law category. Lighter shade for Violation and Misdemeanor and darker shade for Felony.
Size: The marker size increases with the age group. Smaller markers for younger suspects and larger markers for older.
Shootings
Color: The red shade is determined by whether the shooting resulted in a fatality. Lighter shade for victim survival and darker shade for victim fatality.
Size: The marker size increases with the age group. Smaller markers for younger victims and larger markers for older.
Summons
Color: The orange shade is determined by person's gender. Lighter shade for female and darker shade for male.
Size: The marker size increases with the person's age group.
Crashes
Color: The yellow shade is determined by whether someone was injured or killed. Lighter shade for no injuries or fatalities and darker shade for at least one person either injured or killed.
Size: The marker size increases with the number of people either injured or killed.
Complaints
Color: The purple shade is determined by law category. Lighter shade for Violation and Misdemeanor and darker shade for Felony.
Size: The marker size increases with the victim age group. Smaller markers for younger victim and larger markers for older.

Data Analytics
Knowledge of the availability of emergency medical services contributes topeople’s overall sense of safety, security, and well-being. This module presents avisualization of ambulance and fire response times to life threatening emergenciesin New York City. Life threatening emergencies include cardiac arrest, choking,anaphylactic shock, and major burns. This visualization displays the responsetimes, on a monthly basis, from the period of September 2016 to June of 2019,broken down by New York City borough.

Dataset Description
This dataset was obtained from the New York City Open Data portal and is called “911 Open Data Local Law 119.” It can be found at this website location: https://data.cityofnewyork.us/Public-Safety/911-Open-Data-Local-Law-119/gpny-cuvw. The dataset contained 2500 records when downloaded. This project focused on the category of life threatening emergencies within this dataset.

Cleaning Methods
A CSV format and pandas was selected to load and clean the data. The stepstaken in the pandas cleaning file included:

Filtering based on the selected category (combined ems and fireresponse)
Converting the response times from seconds to minutes
Creating a dataframe for each specific borough
Reorganizing, renaming, and dropping columns
Calculating minimum and maximum times for each borough andputting it in a summary chart

Visualization
A line graph was used because we wanted to easily identify the responsetime in any given month, see how the response time changed over time, and alsocompare the response times between different boroughs.

The dataset already contained the number of incidents to which eachborough was responding, and so this was superimposed on top of the line chart foreach borough visualization.

Using a bar graph for the number of incidents and using a line graph for theresponse times seemed to be a good way to distinguish and visually keep track ofwhat was going on in two different situations.

Animating the line graphs in situations where you are seeing if somethinggets better or worse over time, or where you are comparing performance betweenmultiple groups, adds an element of suspense to the result being displayed.

Plotly was used for the visualization and its animate command allowed youto make the graphs dynamic. Information on Plotly’s animate command and howto animate the data may be found here: https://plot.ly/javascript/animations/

Analysis/Takeaways
The average response time in minutes by NYC fire and ambulanceunits to life threatening emergencies ranges from 7 to 10 minutes.

No borough has had an average response time over 10 minutes

No borough has had an average response time under 7 minutes

Staten Island is performing the best out of all five boroughs with anaverage response time hovering between 7.5 minutes and 8 minutes.Staten Island also has a significantly lower number of incidents that itis responding to, between 2000 and 3000, whereas all the otherboroughs have incident numbers in the tens of thousands.

The Bronx is performing the worst out of all five boroughs. They areresponding to roughly 9000 to 12000 incidents, but Brooklyn is doing a much better job and responding to between 12000 and 14000incidents

Each borough was able to achieve an average response time of undereight minutes in one month between September of 2016 and June of2019.

Average response times to medical emergencies between Septemberof 2016 and June of 2019 increased:

Manhattan: Approximately 13 seconds

Queens: Approximately 23 seconds

Brooklyn: Approximately 33 seconds

Bronx: 1 minute

Staten Island: Approximately 18 seconds

There does not seem to be a sharp rise in the number of life threatening emergencies.


Web Scraping Operations
In addition to the data sets we used for the map and the charts, we also webscraped multiple news sites and Twitter so that our users can pull in the most current news in New York City. Social media will often have stories quicker thanother news outlets so we thought it would be crucial for people to have access tothis information all in one page.

Beautiful Soup was utilized to scrape the data. The data types included arearticle titles, summaries, and URL’s. In addition, Twitter feeds from the variousaccounts were also extracted. A Python scrape file was created and linked to aFlask application to run the scrape function and display it on an HTML page.

Below are the sources of data:

News Sites
NY Times
Daily News
NBC New York
Pix 11
Twitter Sites
NYPD News
NYPD Schools
NYC Emergency Management
NYPD Crime Stoppers
FDNY News
The Gothamist
Safety First NYC
NYC Fire


EMS Machine Learning

Using our EMS data set for New York City, I set out to build a machine learning model. Based on several features, I tried to predict the response time in an emergency for EMS services.

Features:
-	Severity of the EMS call
-	Borough (location of incident)
-	Hour of the day
-	Day of the week

Data Cleaning:
The data set included many columns that were considered for the model but were eventually dismissed. After including and testing them in the model, I concluded that they had a negative impact on my model, or no impact at all. 

The data set contained 8.5 million records. After many experiments, I realized using more than 2 million records caused no significant changes in the accuracy of the model. Therefore, I limited my data set to 2 million records for speed and processing. 

The timestamp column had to be converted from an object to a date time data type. This was necessary to allow me to extract the hour of the day and the day of the week, which were two important features of the model.

Building the Model
Since my model has multiple features with the goal of predicting a single output, I ran the data through a Multiple Linear Regression model. Using the get_dummies() function, I encoded the non-numerical features that exist in my model. Those features are Borough, Hour of the day, and Day of the week. Next, I used the train_test_split method to create training and testing data before the scaling and normalization process. I tested the model against mean squared error and R2 and the accuracy was much lower than expected.

Next, I tested the data against a Random Forest model. This method is very memory intensive and my computer was unable to withstand running more than 1,000 rows through this model. I believe because of this, the accuracy score of the model was negatively impacted. Therefore, this model also yielded low results.

The poor test results led me to use the One Hot Encoding method to build my model and see how the results change. I started by fitting and transforming the Borough, Hour of the day, and Day of the week features. After reshaping and fitting my X and y to the model, I came out with an accuracy of 10%. This score is still lower than expected but was significantly higher than using the previous method.

My conclusion is the relevance of the data that I am using to predict EMS response time is very low. Therefore, yielding very low results.

RESIDENTIAL HOUSING CRIMES 2018 (Visualization)

This visualization is called a dendogram and was created in D3.  It is a good way of visualizing hierarchal data and any decision tree algorithms that individuals may choose to implement in machine learning.  The hierarchy is created using data in a json format with root, parent, and children nodes.  This particular dendogram displays the top three crimes committed in residential housing areas (Apartment, Housing, and Public Housing) in New York City broken down by borough.  Recently, there have been reports of people getting killed in their own houses in the news, and this chart can help demonstrate if that is a frequent occurrence.  This chart can provide some insight into how safe people should feel in their homes.  Some of the top crimes that are occurring are Harassment, Assault, Offenses Against Public Order and Sensibility, Petit Larceny, and Grand Larceny to name a few.

NEW YORK CITY PARK CRIME STATISTICS (2014 – 2019)

The markers or points on these two plots represent different parks in New York City.  The park name is revealed if you hover over the park.  The x-axis represents the size of the park in acres.  The y-axis represents the total number of felony complaints reported for that particular park between 2014 and 2019.  This data was passed through a scikit-learn linear regression model to check if there was a correlation between park size and the total number of complaints reported in that park.  The linear regression model came up with a low R2 score and low model score that was not close to 1.  When the crimes were separated by borough the R2 scores increased slightly, with Queens achieving the highest, but these were also not very close to 1.  This may indicate that park size and the total number of felony complaints are more correlated for some boroughs than others, but that in general, these two features are not very correlated.  I thought there would be a correlation between these two features because larger parks would be harder to police and provide a larger area for nefarious activity to occur.  However, because the dataset only reports on felony crimes that were reported, crimes may still be occurring which have gone unreported.  Furthermore, in larger parks, the amount of overall crimes, including misdemeanors and minor crimes may still be taking place.

The underlying data was obtained from New York City Open Data in the form of csv files.  It was cleaned using pandas.  The machine learning portion was done using linear regression scikit-learn and pandas notebooks.  The visualizations were created in Tableau, published to Tableau server, and placed on the website using embedded Tableau links.

NYC Shooting Statistics

This Tableau workbook provides some visualizations quantifying the shooting data that was displayed on the leaflet maps on the NYCity Watch website.  The data shows that shootings, both fatal and non-fatal, have gone down in NYCity between 2006 and 2018.  Most of the shootings took place during the warmer months of the year, June through September.  The largest number of shootings during this period took place in Brooklyn, and the overwhelming number of victims were African-American.  The visualizations from this workbook will eventually be placed in thumbnails on the NYCity Watch website.










